#!/usr/bin/env ruby

require 'Ops'

def exit_failure( reason="", code=1 )
  puts reason; exit
end

def root_dir
  File.dirname( File.dirname( __FILE__ ) )
end unless defined? :root_dir

def pwd_dir
  Dir.pwd
end

bootstrap_files = [
  File.join( 'tasks', 'tasks.rb' ) ]

Rake.application.init( File.basename( $0 ) )

begin
  Dir.chdir( root_dir ) do
    bootstrap_files.each do | f |
      puts "loading => #{ f }"
      require f
    end
  end
rescue => e
  puts e
end

Dir.chdir( pwd_dir ) do
  bootstrap_files.each do | f |
    require f if File.exists? f
  end
end

begin
  Rake.application.top_level
rescue => e
  puts "Failed to call task: #{ e.message }"
end

exit
